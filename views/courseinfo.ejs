<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="<%= csrfToken %>">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/course-styles.css" /> <!-- Changed stylesheet -->
    <script src="https://cdn.tailwindcss.com"></script>

</head>
<body>
    <div class="grid grid-cols-12">
        <div class="col-start-4 col-span-6"> 
            <%- include ('header.ejs') %> 
            <h1 class="text-4xl font-bold my-4">Explore Course Information</h1>
            <h1 class="text-black text-xl mb-4"><%= currentUser.firstName %> <%= currentUser.lastName %></h1>
            <div>
                <% if (currentUser.role === "student") { %>
                    <a href="/student-center"  class="text-white text-md font-semibold px-4 py-2 rounded Center bg-gray-500 hover:bg-gray-900">Back to Center</a>
                <% } else { %>
                    <a href="/educator-center" class="text-white text-md font-semibold px-4 py-2 rounded Center bg-gray-500 hover:bg-gray-900">Back to Center</a>
                <% } %>
                <!-- <h2 class="text-2xl gap-2 font-semibold"><%= course.courseName %></h2>
                <p class="text-gray-700 mb-4"><b>Content:</b> <%= course.courseContent %></p> -->
            </div>
            <div class="bg-gray-100 p-4 m-4">
                <h2 class="text-3xl font-semibold m-2 border-b-2 p-3 bg-blue-100"><strong><%= course.courseName %></strong></h2>
                <p class="text-lg mb-2"><strong>Course ID:</strong> <%= course.id %></p>
                <p class="text-lg mb-2"><strong>Created By:</strong> <%= userofCourse.firstName %> <%= userofCourse.lastName %></p>
                <p class="text-lg mb-2"><strong>Email:</strong> <%= userofCourse.email %></p>
                <p class="text-lg mb-2"><strong>Content:</strong> <%= course.courseContent %></p>
                <p class="text-lg mb-2">
                    <b>Chapters:</b>
                    <% const isEnrolled = enrols.some(enrollment => enrollment.userId === currentUser.id && enrollment.courseId === course.id); %>
                    <% if(!isEnrolled) { %>
                        <span class="text-lg font-semibold italic px-1 text-red-600 bg-green-200">Enrol to view content</span>
                    <% } %>
                    <ol class="list-decimal text-lg ml-10 mb-2">
                        <% if (chapters.length === 0) { %>
                            <h3 class="mb-5 text-xl text-gray-600">---No Chapters available</h3>
                        <% } else { %>
                            <% for (let chapter of chapters) { %>
                                <li class="text-blue-600 hover:text-blue-800 hover:underline transition-colors">
                                    <% if (currentUser.role === "teacher") { %>
                                        <a href="/view-chapter/<%= chapter.id %>/createpage?currentUserId=<%= encodeURIComponent(currentUser.id) %>"><%= chapter.chapterName %></a>
                                    <% } else if (currentUser.role === "student") { %>
                                        <% if (isEnrolled) { %>
                                            <a href="/view-chapter/<%= chapter.id %>/createpage?currentUserId=<%= encodeURIComponent(currentUser.id) %>"><%= chapter.chapterName %></a>
                                        <% } else { %>
                                            <%= chapter.chapterName %>
                                        <% } %>
                                    <% } %>
                                </li>
                            <% } %>
                        <% } %>
                    </ol>
                </p>
                <% if(userofCourse.id === currentUser.id) { %>
                    <a href="/view-course/<%= course.id %>/buildChapter?currentUserId=<%= currentUser.id %>" class="bg-blue-600 text-white px-4 py-2 rounded font-xl hover:bg-blue-700 text-center ml-5">
                        Create a New Chapter
                    </a>
                <% } %>
            </div>
        </div>
    </div>
</body>
</html>
